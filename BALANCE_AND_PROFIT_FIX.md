# Исправление расчета баланса и прибыли трейдера

## Проблема
При создании транзакций не списывался баланс трейдера и прибыль показывалась как 0 USDT.

## Причина
При переходе транзакции в статус READY (завершенная) в сервисе `NotificationAutoProcessorService` происходило только изменение статуса, но не выполнялись финансовые операции.

## Решение

### 1. Добавлено поле `traderProfit` в модель Transaction
В схеме Prisma добавлено поле для хранения прибыли трейдера:
```prisma
traderProfit Float? // Прибыль трейдера в USDT
```

### 2. Обновлен метод `updateTransactionStatus` в NotificationAutoProcessorService
Теперь при завершении транзакции:

1. **Рассчитывается прибыль трейдера**:
   - Используется курс с KKK (поле `rate`) для расчетов
   - Вычисляется потраченная сумма USDT: `amount / rate`
   - Прибыль = комиссия от потраченной суммы

2. **Обновляются балансы трейдера**:
   - Уменьшается замороженный баланс (`frozenUsdt`)
   - Уменьшается доверительный баланс (`trustBalance`) на потраченную сумму
   - Увеличивается прибыль от сделок (`profitFromDeals`)
   - Увеличивается доступный баланс (`deposit`) на прибыль

3. **Сохраняется прибыль в транзакции** для отображения в интерфейсе

### 3. Обновлено отображение прибыли в трейдерском интерфейсе
В `/routes/trader/transactions.ts` теперь используется сохраненная прибыль из базы данных вместо расчета на лету.

## Результат
Теперь при завершении транзакции:
- Правильно списывается баланс трейдера
- Рассчитывается и сохраняется прибыль трейдера
- Прибыль корректно отображается в интерфейсе трейдера

## Важно
Все расчеты используют поле `rate` (курс Rapira с KKK), а не `merchantRate`, который предназначен только для отображения мерчанту.
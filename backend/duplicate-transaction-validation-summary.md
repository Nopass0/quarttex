# Валидация дублирующихся транзакций

## Описание
Добавлена защита от создания дублирующихся транзакций с одинаковой суммой на одном и том же реквизите. Это предотвращает проблемы с автоматическим матчингом уведомлений.

## Реализованные изменения

### 1. Merchant API (`/backend/src/routes/merchant/index.ts`)

#### Endpoint: `/merchant/transactions/create`
- При подборе реквизита добавлена проверка на наличие активных транзакций (статусы CREATED или IN_PROGRESS) с той же суммой
- Если найдена такая транзакция, реквизит пропускается и ищется следующий подходящий

#### Endpoint: `/merchant/transactions/in`
- Аналогичная проверка добавлена в упрощенный эндпоинт создания входящих транзакций

### 2. Admin API (`/backend/src/routes/admin/transactions.ts`)

#### Endpoint: `PUT /admin/transactions/trader`
- При назначении трейдера на транзакцию проверяется, нет ли на том же реквизите активной транзакции с той же суммой
- Если такая транзакция найдена, выдается ошибка: "Невозможно назначить трейдера: на реквизите уже есть активная транзакция на сумму X рублей"

#### Endpoint: `POST /admin/transactions/test/in`
- При создании тестовой транзакции добавлена такая же проверка дубликатов

### 3. Frontend (`/frontend/components/deals/deals-list.tsx`)
- Убрана кнопка "Подтвердить платеж" для истекших сделок (статус EXPIRED)
- Вместо кнопки показывается текст "Срок сделки истек"

## Логика работы

1. При создании новой транзакции или назначении трейдера система проверяет:
   - Есть ли на реквизите транзакция с той же суммой
   - Находится ли эта транзакция в статусе CREATED или IN_PROGRESS
   - Является ли это входящей транзакцией (тип IN)

2. Если все условия выполнены, реквизит считается занятым и:
   - При автоматическом подборе - ищется другой реквизит
   - При ручном назначении - выдается ошибка

3. Транзакция считается "завершенной" и не блокирует реквизит, если она в статусах:
   - READY
   - CANCELED
   - EXPIRED
   - DISPUTE

## Преимущества
- Предотвращает ситуации, когда одно банковское уведомление может быть заматчено с несколькими транзакциями
- Обеспечивает корректную работу автоматического матчинга
- Улучшает надежность системы обработки платежей
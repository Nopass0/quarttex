# Дневной лимит транзакций и проверка баланса

## Реализованные изменения

### 1. Дневной лимит транзакций на реквизите

#### Frontend изменения:
- **AddBTRequisiteDialog** (`/frontend/components/bt-entry/add-bt-requisite-dialog.tsx`)
  - Добавлено поле `maxCountTransactions` с значением по умолчанию 5
  - Добавлено описание: "0 = без ограничений"
  
- **AddRequisiteDialog** (`/frontend/components/trader/add-requisite-dialog.tsx`)
  - Аналогично добавлено поле дневного лимита транзакций

#### Backend изменения:
- **Merchant API** (`/backend/src/routes/merchant/index.ts`)
  - В эндпоинте `/transactions/create`: проверка `maxCountTransactions > 0` перед применением лимита
  - В эндпоинте `/transactions/in`: добавлена проверка дневного лимита транзакций
  
- **Admin API** (`/backend/src/routes/admin/transactions.ts`)
  - В эндпоинте `/transactions/test/in`: добавлена проверка дневного лимита транзакций

### 2. Логика работы дневного лимита

- Если `maxCountTransactions = 0` или `null`, лимит не применяется
- Если `maxCountTransactions > 0`, проверяется количество транзакций за текущий день
- Учитываются только транзакции со статусом != CANCELED
- При превышении лимита реквизит пропускается при автоматическом подборе

### 3. Проверка баланса трейдера

Проверка баланса уже была реализована во всех эндпоинтах создания транзакций:

- **Расчет доступного баланса**: `availableBalance = trustBalance - frozenUsdt`
- **Проверка перед созданием транзакции**: если `availableBalance < totalRequired`, транзакция не создается
- **Ошибка**: "Недостаточно баланса трейдера"

Проверка происходит в:
- `/merchant/transactions/create` (строки 840-844)
- `/merchant/transactions/in` (строки 1212-1217)
- Функции `freezeTraderBalance` в `/backend/src/utils/transaction-freezing.ts`

## Примеры использования

### Создание реквизита с лимитом:
```json
{
  "methodId": "method_id",
  "bankType": "SBER",
  "cardNumber": "1234567890123456",
  "recipientName": "Иван Иванов",
  "minAmount": 1000,
  "maxAmount": 100000,
  "dailyLimit": 500000,
  "monthlyLimit": 10000000,
  "maxCountTransactions": 5  // Максимум 5 транзакций в день
}
```

### Создание реквизита без лимита:
```json
{
  // ... другие поля
  "maxCountTransactions": 0  // Без ограничений на количество транзакций
}
```

## Преимущества

1. **Гибкость**: Трейдеры могут настраивать лимиты индивидуально для каждого реквизита
2. **Защита от перегрузки**: Предотвращает слишком частое использование одного реквизита
3. **Защита от отрицательного баланса**: Транзакции не создаются, если недостаточно средств
4. **Обратная совместимость**: Значение 0 отключает лимит, что сохраняет старое поведение